<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Download â€¢ mapme.vegetation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Download">
<meta property="og:description" content="mapme.vegetation">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapme.vegetation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/terminology.html">Terminology</a>
    </li>
    <li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
    <li>
      <a href="../articles/download.html">Download</a>
    </li>
    <li>
      <a href="../articles/cloudmasking.html">Cloud Masking</a>
    </li>
    <li>
      <a href="../articles/indices.html">Calculate Indices</a>
    </li>
    <li>
      <a href="../articles/trends.html">Calculate Trends</a>
    </li>
    <li>
      <a href="../articles/zonalstats.html">Extract zonal statistics</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="download_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Download</h1>
            
            <h4 class="date">Last modified: 2021-10-21</h4>
      
      
      <div class="hidden name"><code>download.Rmd</code></div>

    </div>

    
    
<p>The <code>mapme.vegetation</code> package allows us to easily download and work with Sentinel-2 (S2) Level 2A datasets. These datasets represent bottom of atmosphere (BOA) reflectance values processed with <a href="https://step.esa.int/main/snap-supported-plugins/sen2cor/">sen2cor</a>. The data is made available via the <a href="https://stacindex.org/catalogs/earth-search#/">Earth Search</a> STAC API from AWS. <code>mapme.vegetation</code> can be used to query the server for a given spatio-temporal extent of interest and download matching results. S2 download from AWS is free of cost and does not require a user account. However, users should be aware that there is a maximum of 500 items per query. In case the spatio-temporal extent will lead to more items it is up to the user to split up the query into suitable chunks. The package allows for querying the data without a direct download in order to check the items returned.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mapme.vegetation</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</span>

<span class="va">aoi</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"exp_region_wgs.gpkg"</span>, package <span class="op">=</span> <span class="st">"mapme.vegetation"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span>
<span class="va">rundir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mapme.vegetation"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">rundir</span>, showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">items</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_aws.html">download_aws</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, 
                      after <span class="op">=</span> <span class="st">"2017-05-01"</span>, 
                      before <span class="op">=</span> <span class="st">"2017-07-31"</span>, 
                      timeframe <span class="op">=</span> <span class="st">"full"</span>, 
                      max.cloud <span class="op">=</span> <span class="fl">40</span>, 
                      query_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; STAC version: 1.0.0-beta.2</span>
<span class="co">#&gt; Querying data for temporal window 2017-05-01/2017-07-31</span>
<span class="co">#&gt; The following items matched the specified spatiotemporal extent.</span>
<span class="co">#&gt; ###STACItemCollection</span>
<span class="co">#&gt; - matched feature(s): 11</span>
<span class="co">#&gt; - features (11 item(s)):</span>
<span class="co">#&gt;   - S2B_38PLR_20170727_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170722_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20170717_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170712_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20170707_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170702_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170622_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170612_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170602_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170523_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170503_0_L2A</span>
<span class="co">#&gt; - field(s): </span>
<span class="co">#&gt; type, stac_version, stac_extensions, context, numberMatched, numberReturned, features, links</span></code></pre></div>
<p>The query resulted in 11 items matching the spatio-temporal extent with a maximum cloud cover of 40%. We can proceed downloading the data by setting <code>query_only = FALSE</code> and supply additional arguments of where to write the files</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">items</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_aws.html">download_aws</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, 
                     after <span class="op">=</span> <span class="st">"2017-05-01"</span>, 
                     before <span class="op">=</span> <span class="st">"2017-07-31"</span>, 
                     timeframe <span class="op">=</span> <span class="st">"full"</span>, 
                     max.cloud <span class="op">=</span> <span class="fl">40</span>, 
                     outdir <span class="op">=</span> <span class="va">rundir</span>, 
                     query_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The above call with download the data sequentially. As a alternative <code>mapme.vegetation</code> allows to download the data via the <a href="https://aria2.github.io/">aria2</a> download utility. Userâ€™s have to install the program manually on their machine and indicate the path to the aria2 binary. Additionall arguments are required to specify how many connections to the server should be established to download matching items in parallel. The function call below will download 4 items in parallel with a total of 4 connections per file to further speed up the download. Also, the retry argument can be set to specify the number of time the the function will retry to download items for which the download failed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">items</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_aws.html">download_aws</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, 
                     after <span class="op">=</span> <span class="st">"2017-05-01"</span>, 
                     before <span class="op">=</span> <span class="st">"2017-07-30"</span>, 
                     timeframe <span class="op">=</span> <span class="st">"full"</span>, 
                     max.cloud <span class="op">=</span> <span class="fl">40</span>, 
                     outdir <span class="op">=</span> <span class="va">rundir</span>, 
                     query_only <span class="op">=</span> <span class="cn">FALSE</span>,
                     use_aria <span class="op">=</span> <span class="cn">T</span>,
                     aria_bin <span class="op">=</span> <span class="st">"/usr/bin/aria2c"</span>, 
                     max_concurrent <span class="op">=</span> <span class="fl">4</span>, 
                     max_connections <span class="op">=</span> <span class="fl">4</span>,
                     retry <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Note that in the above function calls <code>timeframe = "full"</code>. This way, the function will download all the matching items between the <code>after</code> and <code>before</code> dates (inclusive). If you want to request only specific months but across years specify <code>timeframe = "seasonal"</code> to loop over the years and download the matching time period. Note that the items are returned as a list with each object representing one of the queried years.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">items</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_aws.html">download_aws</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, 
                      after <span class="op">=</span> <span class="st">"2017-05-01"</span>, 
                      before <span class="op">=</span> <span class="st">"2020-07-30"</span>, 
                      timeframe <span class="op">=</span> <span class="st">"seasonal"</span>, 
                      max.cloud <span class="op">=</span> <span class="fl">40</span>, 
                      query_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; STAC version: 1.0.0-beta.2</span>
<span class="co">#&gt; Querying data for temporal window 2017-05-01/2017-07-30</span>
<span class="co">#&gt; The following items matched the specified spatiotemporal extent.</span>
<span class="co">#&gt; ###STACItemCollection</span>
<span class="co">#&gt; - matched feature(s): 11</span>
<span class="co">#&gt; - features (11 item(s)):</span>
<span class="co">#&gt;   - S2B_38PLR_20170727_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170722_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20170717_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170712_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20170707_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170702_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170622_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170612_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170602_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170523_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20170503_0_L2A</span>
<span class="co">#&gt; - field(s): </span>
<span class="co">#&gt; type, stac_version, stac_extensions, context, numberMatched, numberReturned, features, links</span>
<span class="co">#&gt; Querying data for temporal window 2018-05-01/2018-07-30</span>
<span class="co">#&gt; The following items matched the specified spatiotemporal extent.</span>
<span class="co">#&gt; ###STACItemCollection</span>
<span class="co">#&gt; - matched feature(s): 17</span>
<span class="co">#&gt; - features (17 item(s)):</span>
<span class="co">#&gt;   - S2A_38PLR_20180727_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180722_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180717_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180712_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180707_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180702_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180627_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180622_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180617_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180612_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180607_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180602_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180528_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180523_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180513_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20180508_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20180503_0_L2A</span>
<span class="co">#&gt; - field(s): </span>
<span class="co">#&gt; type, stac_version, stac_extensions, context, numberMatched, numberReturned, features, links</span>
<span class="co">#&gt; Querying data for temporal window 2019-05-01/2019-07-30</span>
<span class="co">#&gt; The following items matched the specified spatiotemporal extent.</span>
<span class="co">#&gt; ###STACItemCollection</span>
<span class="co">#&gt; - matched feature(s): 17</span>
<span class="co">#&gt; - features (17 item(s)):</span>
<span class="co">#&gt;   - S2B_38PLR_20190727_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190722_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190717_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190707_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190702_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190627_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190622_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190617_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190612_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190607_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190528_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190523_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190518_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190513_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190508_1_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20190508_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20190503_0_L2A</span>
<span class="co">#&gt; - field(s): </span>
<span class="co">#&gt; type, stac_version, stac_extensions, context, numberMatched, numberReturned, features, links</span>
<span class="co">#&gt; Querying data for temporal window 2020-05-01/2020-07-30</span>
<span class="co">#&gt; The following items matched the specified spatiotemporal extent.</span>
<span class="co">#&gt; ###STACItemCollection</span>
<span class="co">#&gt; - matched feature(s): 10</span>
<span class="co">#&gt; - features (10 item(s)):</span>
<span class="co">#&gt;   - S2B_38PLR_20200711_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20200706_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20200701_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20200626_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20200621_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20200616_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20200527_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20200522_0_L2A</span>
<span class="co">#&gt;   - S2A_38PLR_20200517_0_L2A</span>
<span class="co">#&gt;   - S2B_38PLR_20200512_0_L2A</span>
<span class="co">#&gt; - field(s): </span>
<span class="co">#&gt; type, stac_version, stac_extensions, context, numberMatched, numberReturned, features, links</span></code></pre></div>
<p>If you are only interested in specific bands you can reduce the files to download by specyfing the assets you wish to download.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">items</span> <span class="op">=</span> <span class="fu"><a href="../reference/download_aws.html">download_aws</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, 
                      after <span class="op">=</span> <span class="st">"2017-05-01"</span>, 
                      before <span class="op">=</span> <span class="st">"2017-07-30"</span>, 
                      timeframe <span class="op">=</span> <span class="st">"full"</span>, 
                      assets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B04"</span>, <span class="st">"B08"</span>, <span class="st">"SCL"</span><span class="op">)</span>,
                      max.cloud <span class="op">=</span> <span class="fl">40</span>, 
                      query_only <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mapme-initiative.org/">MAPME-Initiative</a>, <a href="http://dariusgoergen.com/">Darius GÃ¶rgen</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
